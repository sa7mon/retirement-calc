"use strict";var chart1,chart2;window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"};var temp_datasets,rmds={70:27.4,71:26.5,72:25.6,73:24.7,74:23.8,75:22.9,76:22,77:21.2,78:20.3,79:19.5,80:18.7,81:17.9,82:17.1,83:16.3,84:15.5,85:14.8,86:14.1,87:13.4,88:12.7,89:12,90:11.4,91:10.8,92:10.2,93:9.6,94:9.1,95:8.6,96:8.1,97:7.6,98:7.1,99:6.7,100:6.3,101:5.9};function init(){$("#form-1").submit(function(r){r.preventDefault(),$(".chart-row").removeClass("hidden"),$("#table-row").removeClass("hidden"),$("#output-row").removeClass("hidden");for(var a=[],t=1;t<4;t++){var e=calculate(Number($("#inp_current_age-1").val()),Number($("#inp_curr_nest_egg-"+t).val()),Number($("#inp_curr_salary-"+t).val()),Number($("#inp_contribution_percent-"+t).val())/100,Number($("#inp_retire_age-"+t).val()),Number($("#inp_nest_egg_growth-"+t).val())/100,Number($("#inp_lame_age-"+t).val()),Number($("#inp_death_age-1").val()),Number($("#inp_active_years_income-"+t).val()),Number($("#inp_inactive_years_income-"+t).val()));a.push(e)}drawChart1((temp_datasets=a)[0],a[1],a[2],2),drawChart2(a[0],a[1],a[2],2),createTable(a),showOutput(a)})}function showOutput(r){for(var a=0;a<3;a++){for(var t=0,e=0,o=0;o<r[a].length;o++){var n=r[a][o];n.nest_egg>t&&(t=n.nest_egg),e+=n.draw}$("#max-egg-run-"+(a+1)).text("$"+addCommas(round2(t))),$("#total-received-"+(a+1)).text("$"+addCommas(round2(e)))}}function createTable(r){$("table#table tbody").html("");for(var a=0;a<r[0].length;a++)$("table#table tbody").append("<tr>\n        <td>"+r[0][a].age+"</td>\n        <td>$"+addCommas(r[0][a].nest_egg)+"</td>\n        <td>$"+addCommas(r[1][a].nest_egg)+"</td>\n        <td>$"+addCommas(r[2][a].nest_egg)+"</td>\n        </tr>")}function drawChart2(r,a,t,e){var o=nthArray(r.map(function(r){return r.draw}),e),n=nthArray(a.map(function(r){return r.draw}),e),l=nthArray(t.map(function(r){return r.draw}),e),d=nthArray(r.map(function(r){return r.age}),e);void 0!==chart2&&chart2.destroy();var i=$("#chart-2"),u=new Chart(i,{type:"line",data:{labels:d,datasets:[{data:o,fill:!1,borderColor:window.chartColors.red,backgroundColor:window.chartColors.red,label:"Run 1"},{data:n,fill:!1,borderColor:window.chartColors.green,backgroundColor:window.chartColors.green,label:"Run 2"},{data:l,fill:!1,borderColor:window.chartColors.blue,backgroundColor:window.chartColors.blue,label:"Run 3"}]},options:{layout:{padding:{right:20}},tooltips:{callbacks:{label:function(r,a){return"$"+r.yLabel.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},legend:{labels:{fontColor:"#FFF"}},scales:{yAxes:[{ticks:{callback:function(r,a,t){return"$"+addCommas(r)},fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}],xAxes:[{ticks:{fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}]}}});chart2=u}function drawChart1(r,a,t,e){var o=r.map(function(r){return r.nest_egg}),n=r.map(function(r){return r.age}),l=nthArray(o,e),d=nthArray(n,e),i=nthArray(a.map(function(r){return r.nest_egg}),e),u=nthArray(t.map(function(r){return r.nest_egg}),e);void 0!==chart1&&chart1.destroy();var s=$("#chart-1"),c=new Chart(s,{type:"line",data:{labels:d,datasets:[{data:l,fill:!1,borderColor:window.chartColors.red,backgroundColor:window.chartColors.red,label:"Run 1"},{data:i,fill:!1,borderColor:window.chartColors.green,backgroundColor:window.chartColors.green,label:"Run 2"},{data:u,fill:!1,borderColor:window.chartColors.blue,backgroundColor:window.chartColors.blue,label:"Run 3"}]},options:{layout:{padding:{right:20}},tooltips:{callbacks:{label:function(r,a){return"$"+r.yLabel.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},legend:{labels:{fontColor:"#FFF"}},scales:{yAxes:[{ticks:{callback:function(r,a,t){return"$"+addCommas(r)},fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}],xAxes:[{ticks:{fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}]}}});chart1=c}function calculate(r,a,t,e,o,n,l,d,i,u){for(var s=[],c=a,g=t,b=r+1;b<=d;b++){var h=0,m=0,C=o<=b;g=o<=b?0:g+.02*g;var f=o<=b?0:g*e;if(c+=f,o<=b&&b<l)h=(p=getRmd(b,c))<i?i:p;else if(o<=b&&l<=b){var p;h=(p=getRmd(b,c))<u?u:p}(c-=m=c<h?c:h)<0&&(c=0);var w=c*n;c+=w;var v={age:b,retired:C,salary:round2(g),contrib:round2(f),draw:m,interest:round2(w),nest_egg:round2(c)};s.push(v)}return s}function getRmd(r,a){return null==rmds[r]?0:a/rmds[r]}function round(r,a){return Number(Math.round(r+"e"+a)+"e-"+a)}function round2(r){return parseFloat(Math.round(100*r)/100).toFixed(2)}function nthArray(r,a){for(var t=[],e=0;e<r.length;e+=a)t.push(r[e]);return t}function addCommas(r){for(var a=(r+="").split("."),t=a[0],e=1<a.length?"."+a[1]:"",o=/(\d+)(\d{3})/;o.test(t);)t=t.replace(o,"$1,$2");return t+e}