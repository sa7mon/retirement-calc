"use strict";var chart1,chart2;window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"};var temp_datasets,rmds={70:27.4,71:26.5,72:25.6,73:24.7,74:23.8,75:22.9,76:22,77:21.2,78:20.3,79:19.5,80:18.7,81:17.9,82:17.1,83:16.3,84:15.5,85:14.8,86:14.1,87:13.4,88:12.7,89:12,90:11.4,91:10.8,92:10.2,93:9.6,94:9.1,95:8.6,96:8.1,97:7.6,98:7.1,99:6.7,100:6.3,101:5.9};function init(){$("#form-1").submit(function(r){r.preventDefault(),$(".chart-row").removeClass("hidden"),$("#table-row").removeClass("hidden"),$("#output-row").removeClass("hidden");for(var t=[],a=1;a<4;a++){var e=calculate(Number($("#inp_current_age-1").val()),Number($("#inp_curr_nest_egg-"+a).val()),Number($("#inp_curr_salary-"+a).val()),Number($("#inp_contribution_percent-"+a).val())/100,Number($("#inp_retire_age-"+a).val()),Number($("#inp_nest_egg_growth-"+a).val())/100,Number($("#inp_lame_age-"+a).val()),Number($("#inp_death_age-1").val()),Number($("#inp_active_years_income-"+a).val()),Number($("#inp_inactive_years_income-"+a).val()));t.push(e)}drawChart1((temp_datasets=t)[0],t[1],t[2],2),drawChart2(t[0],t[1],t[2],2),createTable(t),showOutput(t)})}function showOutput(r){for(var t=0;t<3;t++){for(var a=0,e=0,o=0;o<r[t].length;o++){var n=r[t][o];n.nest_egg>a&&(a=n.nest_egg),e+=n.draw}$("#max-egg-run-"+(t+1)).text("$"+addCommas(round(a,2))),$("#total-received-"+(t+1)).text("$"+addCommas(round(e,2)))}}function createTable(r){$("table#table tbody").html("");for(var t=0;t<r[0].length;t++)$("table#table tbody").append("<tr>\n        <td>"+r[0][t].age+"</td>\n        <td>$"+r[0][t].nest_egg+"</td>\n        <td>$"+r[1][t].nest_egg+"</td>\n        <td>$"+r[2][t].nest_egg+"</td>\n        </tr>")}function drawChart2(r,t,a,e){var o=nthArray(r.map(function(r){return r.draw}),e),n=nthArray(t.map(function(r){return r.draw}),e),l=nthArray(a.map(function(r){return r.draw}),e),d=nthArray(r.map(function(r){return r.age}),e);void 0!==chart2&&chart2.destroy();var i=$("#chart-2"),u=new Chart(i,{type:"line",data:{labels:d,datasets:[{data:o,fill:!1,borderColor:window.chartColors.red,backgroundColor:window.chartColors.red,label:"Run 1"},{data:n,fill:!1,borderColor:window.chartColors.green,backgroundColor:window.chartColors.green,label:"Run 2"},{data:l,fill:!1,borderColor:window.chartColors.blue,backgroundColor:window.chartColors.blue,label:"Run 3"}]},options:{layout:{padding:{right:20}},tooltips:{callbacks:{label:function(r,t){return"$"+r.yLabel.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},legend:{labels:{fontColor:"#FFF"}},scales:{yAxes:[{ticks:{callback:function(r,t,a){return"$"+addCommas(r)},fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}],xAxes:[{ticks:{fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}]}}});chart2=u}function drawChart1(r,t,a,e){var o=r.map(function(r){return r.nest_egg}),n=r.map(function(r){return r.age}),l=nthArray(o,e),d=nthArray(n,e),i=nthArray(t.map(function(r){return r.nest_egg}),e),u=nthArray(a.map(function(r){return r.nest_egg}),e);void 0!==chart1&&chart1.destroy();var c=$("#chart-1"),s=new Chart(c,{type:"line",data:{labels:d,datasets:[{data:l,fill:!1,borderColor:window.chartColors.red,backgroundColor:window.chartColors.red,label:"Run 1"},{data:i,fill:!1,borderColor:window.chartColors.green,backgroundColor:window.chartColors.green,label:"Run 2"},{data:u,fill:!1,borderColor:window.chartColors.blue,backgroundColor:window.chartColors.blue,label:"Run 3"}]},options:{layout:{padding:{right:20}},tooltips:{callbacks:{label:function(r,t){return"$"+r.yLabel.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},legend:{labels:{fontColor:"#FFF"}},scales:{yAxes:[{ticks:{callback:function(r,t,a){return"$"+addCommas(r)},fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}],xAxes:[{ticks:{fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}]}}});chart1=s}function calculate(r,t,a,e,o,n,l,d,i,u){for(var c=[],s=t,g=a,b=r+1;b<=d;b++){var h=0,m=o<=b;g=o<=b?0:g+.02*g;var f=o<=b?0:g*e;if(s+=f,o<=b&&b<l)h=(C=getRmd(b,s))<i?i:C;else if(o<=b&&l<=b){var C;h=(C=getRmd(b,s))<u?u:C}(s-=h)<0&&(s=0);var p=s*n;s+=p;var w={age:b,retired:m,salary:round(g,2),contrib:round(f,2),draw:h,interest:round(p,2),nest_egg:round(s,2)};c.push(w)}return c}function getRmd(r,t){return null==rmds[r]?0:t/rmds[r]}function round(r,t){return Number(Math.round(r+"e"+t)+"e-"+t)}function nthArray(r,t){for(var a=[],e=0;e<r.length;e+=t)a.push(r[e]);return a}function addCommas(r){for(var t=(r+="").split("."),a=t[0],e=1<t.length?"."+t[1]:"",o=/(\d+)(\d{3})/;o.test(a);)a=a.replace(o,"$1,$2");return a+e}