"use strict";var chart1,chart2;window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"};var temp_datasets,rmds={70:27.4,71:26.5,72:25.6,73:24.7,74:23.8,75:22.9,76:22,77:21.2,78:20.3,79:19.5,80:18.7,81:17.9,82:17.1,83:16.3,84:15.5,85:14.8,86:14.1,87:13.4,88:12.7,89:12,90:11.4,91:10.8,92:10.2,93:9.6,94:9.1,95:8.6,96:8.1,97:7.6,98:7.1,99:6.7,100:6.3,101:5.9};function init(){$("#form-1").submit(function(r){r.preventDefault(),$(".chart-row").removeClass("hidden"),$("#table-row").removeClass("hidden"),$("#output-row").removeClass("hidden");for(var t=[],e=1;e<4;e++){var a=calculate(Number($("#inp_current_age-1").val()),Number($("#inp_curr_nest_egg-"+e).val()),Number($("#inp_curr_salary-"+e).val()),Number($("#inp_contribution_percent-"+e).val())/100,Number($("#inp_retire_age-"+e).val()),Number($("#inp_nest_egg_growth-"+e).val())/100,Number($("#inp_lame_age-"+e).val()),Number($("#inp_death_age-1").val()),Number($("#inp_active_years_income-"+e).val()),Number($("#inp_inactive_years_income-"+e).val()));console.log(a),t.push(a)}drawChart1((temp_datasets=t)[0],t[1],t[2],2),drawChart2(t[0],t[1],t[2],2),createTable(t),showOutput(t)})}function showOutput(r){for(var t=0;t<3;t++){for(var e=0,a=0,o=0;o<r[t].length;o++){var n=r[t][o];n.nest_egg>e&&(e=n.nest_egg),a+=n.draw}$("#max-egg-run-"+(t+1)).text("$"+addCommas(round(e,2))),$("#total-received-"+(t+1)).text("$"+addCommas(round(a,2)))}}function createTable(r){$("table#table thead tr").append("<td><strong>Age</strong></td>"),$("table#table thead tr").append("<td><strong>Run 1</strong></td>"),$("table#table thead tr").append("<td><strong>Run 2</strong></td>"),$("table#table thead tr").append("<td><strong>Run 3</strong></td>");for(var t=0;t<r[0].length;t++)$("table#table tbody").append("<tr>\n        <td>"+r[0][t].age+"</td>\n        <td>$"+r[0][t].nest_egg+"</td>\n        <td>$"+r[1][t].nest_egg+"</td>\n        <td>$"+r[2][t].nest_egg+"</td>\n        </tr>")}function drawChart2(r,t,e,a){var o=nthArray(r.map(function(r){return r.draw}),a),n=nthArray(t.map(function(r){return r.draw}),a),l=nthArray(e.map(function(r){return r.draw}),a),d=nthArray(r.map(function(r){return r.age}),a);void 0!==chart2&&(console.log("Destroying chart2 before re-drawing"),chart2.destroy());var i=$("#chart-2"),s=new Chart(i,{type:"line",data:{labels:d,datasets:[{data:o,fill:!1,borderColor:window.chartColors.red,backgroundColor:window.chartColors.red,label:"Run 1"},{data:n,fill:!1,borderColor:window.chartColors.green,backgroundColor:window.chartColors.green,label:"Run 2"},{data:l,fill:!1,borderColor:window.chartColors.blue,backgroundColor:window.chartColors.blue,label:"Run 3"}]},options:{layout:{padding:{right:20}},tooltips:{callbacks:{label:function(r,t){return"$"+r.yLabel.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},legend:{labels:{fontColor:"#FFF"}},scales:{yAxes:[{ticks:{callback:function(r,t,e){return"$"+addCommas(r)},fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}],xAxes:[{ticks:{fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}]}}});chart2=s}function drawChart1(r,t,e,a){var o=r.map(function(r){return r.nest_egg}),n=r.map(function(r){return r.age}),l=nthArray(o,a),d=nthArray(n,a),i=nthArray(t.map(function(r){return r.nest_egg}),a),s=nthArray(e.map(function(r){return r.nest_egg}),a);void 0!==chart1&&(console.log("Destroying chart1 before re-drawing"),chart1.destroy());var u=$("#chart-1"),g=new Chart(u,{type:"line",data:{labels:d,datasets:[{data:l,fill:!1,borderColor:window.chartColors.red,backgroundColor:window.chartColors.red,label:"Run 1"},{data:i,fill:!1,borderColor:window.chartColors.green,backgroundColor:window.chartColors.green,label:"Run 2"},{data:s,fill:!1,borderColor:window.chartColors.blue,backgroundColor:window.chartColors.blue,label:"Run 3"}]},options:{layout:{padding:{right:20}},tooltips:{callbacks:{label:function(r,t){return"$"+r.yLabel.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},legend:{labels:{fontColor:"#FFF"}},scales:{yAxes:[{ticks:{callback:function(r,t,e){return"$"+addCommas(r)},fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}],xAxes:[{ticks:{fontColor:"#FFF"},gridLines:{color:"rgba(255, 255, 255, 0.2)"}}]}}});chart1=g}function calculate(r,t,e,a,o,n,l,d,i,s){for(var u=[],g=t,c=e,b=r+1;b<=d;b++){var h=0,p=o<=b;c=o<=b?0:c+.02*c;var m=o<=b?0:c*a;if(g+=m,o<=b&&b<l)console.log("age:",b,"draw:",i,"rmd:",getRmd(b,g)),h=(f=getRmd(b,g))<i?i:f;else if(o<=b&&l<=b){var f;console.log("age:",b,"draw:",s,"rmd:",getRmd(b,g)),h=(f=getRmd(b,g))<s?s:f}(g-=h)<0&&(g=0);var w=g*n;g+=w;var C={age:b,retired:p,salary:round(c,2),contrib:round(m,2),draw:h,interest:round(w,2),nest_egg:round(g,2)};u.push(C)}return u}function getRmd(r,t){return null==rmds[r]?0:t/rmds[r]}function round(r,t){return Number(Math.round(r+"e"+t)+"e-"+t)}function nthArray(r,t){for(var e=[],a=0;a<r.length;a+=t)e.push(r[a]);return e}function addCommas(r){for(var t=(r+="").split("."),e=t[0],a=1<t.length?"."+t[1]:"",o=/(\d+)(\d{3})/;o.test(e);)e=e.replace(o,"$1,$2");return e+a}